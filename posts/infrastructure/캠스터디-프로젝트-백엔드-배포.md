---
title: ìº ìŠ¤í„°ë”” í”„ë¡œì íŠ¸ ì„œë²„ ë°°í¬ ë° SSH ì ‘ì† ë¶ˆê°€ ì´ìŠˆ í•´ê²°
date: 2025-04-20 16:24:33
category: infrastructure
tags:
  ["AWS", "ë°°í¬", "infra", "Docker", "ë°±ì—”ë“œ", "SSH", "ë¬¸ì œí•´ê²°", "ìº ìŠ¤í„°ë””"]
isPrivate: false
---

## ì„œë¡ 

ìº ìŠ¤í„°ë”” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì´ˆê¸°ì— ë¹ ë¥¸ ê°œë°œì„ ìœ„í•´ Supabaseë¡œ ë°±ì—”ë“œë¥¼ êµ¬ì¶•í–ˆìœ¼ë‚˜, ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ í•˜ëŠ” ë°©ì‹ê³¼ ê°€ì¥ ê°€ê¹ê²Œ ì„¤ì •í•˜ê³  ì‹¶ì–´ì„œ APIë¥¼ ë”°ë¡œ ë¶„ë¦¬í•´ì„œ ë§Œë“¤ê¸°ë¡œ ê²°ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
ë°±ì—”ë“œ ì½”ë“œë¥¼ GPTì˜ ë„ì›€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

ë³¸ ê²Œì‹œë¬¼ì—ì„œëŠ” EC2ì™€ Dockerë¥¼ í™œìš©í•œ ì„œë²„ ë°°í¬ ê³¼ì •ê³¼ ë°°í¬ í›„ ì§€ì†ì ìœ¼ë¡œ ë°œìƒí•œ SSH ì ‘ì† ë¶ˆê°€ ë¬¸ì œë¥¼ í•´ê²°í•œ ê³¼ì •ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤.

## ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒ ë° í™˜ê²½

- AWS EC2
- Docker
- Docker Compose
- MySQL
- Spring Boot

## ë°°í¬ ê³¼ì •

ê¸°ì¡´ì˜ ë°°í¬ ë°©ì‹ê³¼ ë‹¬ë¦¬ Dockerë¥¼ ì´ìš©í•œ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ì˜ ë°°í¬ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë¸”ë¡œê·¸ ê¸€ì„ ì°¸ê³ í•˜ì—¬ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ğŸ“˜ ì°¸ê³  ë¬¸ì„œ: [[Docker] ë„ì»¤ë¡œ EC2ì— ì„œë²„ ë°°í¬í•˜ê¸°](https://ye-ryung.tistory.com/116)

ì£¼ìš” Dockerfile ì„¤ì •:

```dockerfile
FROM openjdk:17-jdk-slim AS build
WORKDIR /app
ARG JAR_FILE=build/libs/*.jar
COPY ${JAR_FILE} app.jar

FROM openjdk:17-jdk-slim
WORKDIR /app
COPY src/main/resources/application.yml /app/application.yml
COPY --from=build /app/app.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-Djava.security.egd=file:/dev/./urandom", "-Dotel.resource.attributes=service.name=auth-server", "-jar", "app.jar"]
```

Docker Hubì— ì´ë¯¸ì§€ ë“±ë¡ í›„, EC2ì—ì„œ ì•„ë˜ì˜ Docker Compose ì„¤ì •ìœ¼ë¡œ ë°°í¬í–ˆìŠµë‹ˆë‹¤:

```yaml
version: "3.9"

services:
  mysql:
    image: mysql:8.0
    platform: linux/amd64
    container_name: mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_DATABASE: ${DB_NAME}
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_USER: ${DB_USER}
      MYSQL_PASSWORD: ${DB_PASSWORD}
    volumes:
      - mysql-vl:/var/lib/mysql
    command: >
      --default-authentication-plugin=mysql_native_password
      --innodb_buffer_pool_size=128M
      --max_connections=50
      --table_open_cache=200
      --innodb_log_buffer_size=16M
    restart: always

  app:
    image: yejiii1997/cmas:latest
    platform: linux/amd64
    container_name: camstudy-backend
    depends_on:
      - mysql
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: prod
      DB_HOST: mysql
      DB_PORT: 3306
      DB_NAME: ${DB_NAME}
      DB_USER: ${DB_USER}
      DB_PASSWORD: ${DB_PASSWORD}
    restart: always

volumes:
  mysql-vl:
    driver: local
```

## ğŸ”¥ ë°œìƒí•œ ë¬¸ì œ ë° ì›ì¸ ë¶„ì„

ë°°í¬ í›„ ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•Šì•˜ê³ , ì‹¬ì§€ì–´ SSH ì ‘ì†ì¡°ì°¨ ë¶ˆê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤. EC2ì˜ ìƒíƒœ ê²€ì‚¬ëŠ” 2ê°œ ì¤‘ 1ê°œë§Œ í†µê³¼í•˜ëŠ” ìƒíƒœì˜€ìŠµë‹ˆë‹¤. ë¡œê·¸ í™•ì¸ ê²°ê³¼ ë‹¤ìŒì˜ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤:

```bash
[18167.348589] Out of memory: Killed process 1971 (mysqld) total-vm:1294692kB, anon-rss:369024kB...
```

ì´ëŠ” MySQL í”„ë¡œì„¸ìŠ¤ê°€ ë©”ëª¨ë¦¬ ë¶€ì¡±ìœ¼ë¡œ ì¸í•´ ì»¤ë„ì—ì„œ ê°•ì œ ì¢…ë£Œëœ(OOM Kill) í˜„ìƒì´ì—ˆìŠµë‹ˆë‹¤.

ë‹¹ì‹œ EC2 ë©”ëª¨ë¦¬ ìƒíƒœ:

- ì´ ë©”ëª¨ë¦¬: 957.4 MiB
- MySQL ì‚¬ìš©: 370MB (%MEM 37.8)
- Java ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©: 207MB (%MEM 21.2)
- ë‚¨ì€ ì—¬ìœ  ë©”ëª¨ë¦¬: 69.6 MiB

## í•´ê²° ë°©ì•ˆ

### Swap ë©”ëª¨ë¦¬ ì„¤ì •

ë©”ëª¨ë¦¬ ë¶€ì¡± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Swap ë©”ëª¨ë¦¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```bash
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

### MySQL ë©”ëª¨ë¦¬ ì œí•œ

MySQL ì»¨í…Œì´ë„ˆì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì œí•œí–ˆìŠµë‹ˆë‹¤.

```yaml
command: >
  --default-authentication-plugin=mysql_native_password
  --innodb_buffer_pool_size=128M
  --max_connections=50
  --table_open_cache=200
  --innodb_log_buffer_size=16M
```

| ì„¤ì • í•­ëª©                    | ì„¤ëª…                    |
| ---------------------------- | ----------------------- |
| innodb_buffer_pool_size=128M | InnoDB ìºì‹œ ë©”ëª¨ë¦¬ í¬ê¸° |
| max_connections=50           | ìµœëŒ€ ë™ì‹œ ì ‘ì† ìˆ˜ ì œí•œ  |
| table_open_cache=200         | í…Œì´ë¸” ìºì‹œ ê°œìˆ˜        |
| innodb_log_buffer_size=16M   | ë¡œê·¸ ë²„í¼ í¬ê¸°          |

ì„¤ì • ë³€ê²½ í›„ì—ëŠ” ë°˜ë“œì‹œ Docker ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
docker-compose down
docker-compose up -d
```

### ê°œì„ ëœ ê²°ê³¼

| ì»¨í…Œì´ë„ˆ | ë³€ê²½ ì „   | ë³€ê²½ í›„   | ì°¨ì´    |
| -------- | --------- | --------- | ------- |
| MySQL    | 370MiB    | 248.6MiB  | â†“121MiB |
| Backend  | ê±°ì˜ ë™ì¼ | ê±°ì˜ ë™ì¼ | ìœ ì§€ë¨  |

í˜„ì¬ ì•ˆì •ì ìœ¼ë¡œ ì„œë²„ê°€ ìš´ì˜ ì¤‘ì…ë‹ˆë‹¤. ë‹¤ì‹œëŠ” ì´ëŸ° ë¬¸ì œë¡œ ê¸€ì„ ì“°ì§€ ì•Šê¸°ë¥¼ ë°”ëë‹ˆë‹¤... ì œë°œ~!
